<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提额项目报单计数器</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding-top: 20px;
            padding-bottom: 0;
            cursor: default; /* 确保body上是默认光标 */
        }

        body {
            background-color: white;
            color: black;
        }

            body.dark-mode {
                background-color: black;
                color: white;
            }

        .container {
            position: relative;
            display: inline-block;
            text-align: left;
            max-width: 450px;
            margin: auto;
            padding-bottom: 50px; 
            box-sizing: border-box;
        }
    
        .section {
            border: 1px solid lightgray;
            padding: 5px;
            margin-bottom: 20px;
            max-width: 450px;
        }

        .section > * {
            margin: 10px 0; /* 设置上下间距为 10px */
        }

        .section > *:first-child {
            margin: 20px 0;
        }
    
        .title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 10px;
        }

      
            .tooltip {
                display: inline-block;
                position: relative;
                cursor: pointer;
                margin-left: 5px;
                font-size: 13px;
                border: 1px solid #87CEFA; 
                border-radius: 50%;
                width: 14px;
                height: 14px;
                text-align: center;
                line-height: 15px;
                color: #87CEFA;
                background-color: white;
                font-weight: bold;
            }

                body.dark-mode .tooltip {
                    background-color: #333; 
                }

            .tooltip:hover::after {
                content: attr(data-tooltip);
                position: absolute;
                top: -5px;
                left: 25px;
                background-color: #333;
                color: #fff;
                padding: 5px;
                border-radius: 5px;
                white-space: normal; 
                width: 200px; 
                z-index: 1;
                font-size: 14px;
                line-height: 1.5;
                font-weight: normal;
                white-space: pre-wrap;
                text-align: left; 
            }
                
        .input-row {
            margin-bottom: 5px;
        }
    
        input[type="number"] {
            width: 40px; 
            height: 20px; 
            padding: 3px;
            font-size: 16px;
        }

        .input-row input[type="number"]#targetInput {
            width: 40px; 
            -moz-appearance: textfield; /* Firefox */
            -webkit-appearance: none; /* Safari 和 Chrome */
            appearance: none; /* 现代浏览器 */
        }

        .input-row input[type="number"]#targetInput::-webkit-inner-spin-button,
        .input-row input[type="number"]#targetInput::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .input-row span#nameDisplay {
            margin-right: 15px; 
        }


        .buttons {
            margin-top: 20px;
        }
    
        button {
            padding: 0px 15px;
            font-size: 16px;
            height: 40px; 
            line-height: 40px; 
            text-align: center; 
            border: 2px solid rgba(255, 255, 255, 0.5); 
            border-radius: 5px; 
            cursor: pointer; 
            transition: all 0.3s ease;
            background-color: #f0f0f0; 
            color: #333; 
            box-shadow: inset 0 -2px 5px rgba(0, 0, 0, 0.1), 
                        0 2px 5px rgba(0, 0, 0, 0.2);
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif; 
            font-weight: 600; 
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.7); 
        }



        .green {
            background-color: #4CAF50; 
            color: white; 
        }

        .green:hover {
            background-color: #45a049; 
        }

        .green:active {
            background-color: #66ff66; 
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.7), 
                        inset 0 0 5px rgba(255, 255, 255, 0.7); 
        }

        .yellow {
            background-color: #FFC107; 
            color: #0D2035; 
        }

        .yellow:hover {
            background-color: #ffb300; 
        }

        .yellow:active {
            background-color: #ffff66; 
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.7), 
                        inset 0 0 5px rgba(255, 255, 255, 0.7); 
        }

        .red {
            background-color: #f44336; 
            color: white; 
        }

        .red:hover {
            background-color: #e53935; 
        }

        .red:active {
            background-color: #ff6666; 
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.7), 
                        inset 0 0 5px rgba(255, 255, 255, 0.7); 
        }


        .copy-button {
            background-color: #2196F3; 
            color: white; 
            border: 2px solid rgba(255, 255, 255, 0.5); 
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: inset 0 -2px 5px rgba(0, 0, 0, 0.1), 
                        0 2px 5px rgba(0, 0, 0, 0.2); 
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.7); 
        }

        .copy-button:hover {
            background-color: #1976D2; 
        }

        .copy-button:active {
            background-color: #64B5F6; 
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.7), 
                        inset 0 0 5px rgba(255, 255, 255, 0.7); 
            transform: scale(0.98); 
        }

        .highlight {
            background-color: yellow; 
        }
        
        #nameInput {
            width: 60px; 
            height: 20px; 
            font-size: 16px; 
        }

        #mailbox-container {
            position: absolute;
            bottom: -40px; 
            left: 110px; 
            width: 32px;
            height: 32px;
        }

        #mailbox-tooltip {
            visibility: hidden;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            bottom: 40px;
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 1;
            white-space: nowrap;
            font-size: 12px;
            line-height: 1.4;
            cursor: pointer;
        }

        #mailbox {
            cursor: pointer; 
        }

        #mailbox-container:hover #mailbox-tooltip {
            visibility: visible;
        }

        #library-container {
            position: absolute;
            bottom: -40px; 
            left: 10px; 
            width: 32px;
            height: 32px;
        }

        #library-tooltip {
            visibility: hidden;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            bottom: 40px;
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 1;
            white-space: nowrap;
            font-size: 12px;
            line-height: 1.4;
            cursor: pointer;
        }

        #library {
            cursor: pointer; 
        }

        #library-container:hover #library-tooltip {
            visibility: visible;
        }

        #starship-container {
            position: absolute;
            bottom: -40px; 
            left: 60px; 
            width: 32px;
            height: 32px;
        }

        #starship-tooltip {
            visibility: hidden;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            bottom: 40px;
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 1;
            white-space: nowrap;
            font-size: 12px;
            line-height: 1.4;
            cursor: pointer;
        }

        #starship {
            cursor: pointer; 
        }

        #starship-container:hover #starship-tooltip {
            visibility: visible;
        }

        #theme-selector {
            position: absolute;
            bottom: -40px; 
            right: 10px;   
            padding: 5px;
            font-size: 14px;
            cursor: pointer;
            z-index: 10;
            }

        #result.default {
            word-wrap: break-word; 
            overflow-wrap: break-word; 
            white-space: normal; 
            width: 450px; 
            box-sizing: border-box; 
            padding: 10px; 
            margin-top: 20px; 
            border: 1px solid lightgray; 
            background-color: #f9f9f9; 
        }

            body.dark-mode #result.default {
                background-color: #333; 
                color: #f1f1f1; 
                border: 1px solid #555; 
            }

                  
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
            
        #result.led {
            word-wrap: break-word; 
            overflow-wrap: break-word; 
            white-space: normal; 
            width: 450px; 
            box-sizing: border-box; 
            padding: 20px; 
            margin-top: 20px; 
            border: 2px solid rgba(0, 0, 255, 0.5); 
            background-color: #000; 
            font-family: 'Press Start 2P', cursive;
            color: #00bfff; 
            text-shadow: 
                0 0 5px rgba(0, 191, 255, 0.8), 
                0 0 10px rgba(0, 191, 255, 0.6), 
                0 0 15px rgba(0, 191, 255, 0.4); 
            border-radius: 10px; 
            box-shadow: 0 4px 10px rgba(0, 191, 255, 0.3);
        }


            body.dark-mode #result.led {
                background-color: #000; 
                color: #00bfff; 
                border: 2px solid rgba(0, 0, 255, 0.5);
                text-shadow: 
                    0 0 5px rgba(0, 191, 255, 0.8), 
                    0 0 10px rgba(0, 191, 255, 0.6), 
                    0 0 15px rgba(0, 191, 255, 0.4);
            }


                   
        @import url('https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap');

                  
        #result.blackboard {
            word-wrap: break-word; 
            overflow-wrap: break-word; 
            white-space: normal; 
            width: 450px; 
            box-sizing: border-box; 
            padding: 20px; 
            margin-top: 20px; 
            border: 5px solid #8B4513; 
            background-color: #005f2f; 
            font-family: 'Permanent Marker', cursive; 
            color: #ffffff; 
            border-radius: 10px; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); 
        }


            body.dark-mode #result.blackboard {
                background-color: #003d1f; 
                color: #ffffff; 
            }

                   
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap');

                  
        #result.typewriter {
            word-wrap: break-word; 
            overflow-wrap: break-word; 
            white-space: normal; 
            width: 450px; 
            box-sizing: border-box; 
            padding: 20px; 
            margin-top: 20px; 
            border: 1px solid #000; 
            background-color: #f8f8f8; 
            font-family: 'Courier Prime', monospace; 
            color: #333;
            border-radius: 5px; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        
            body.dark-mode #result.typewriter {
                background-color: #333;
                color: #f8f8f8; 
                border: 1px solid #fff; 
            }

        .theme-switcher {
            position: absolute;
            top: 1px; 
            right: 1px; 
        }

        .icon {
            width: 24px; 
            height: 24px; 
            margin-right: 8px; 
            vertical-align: middle; 
        }

        .theme-switcher {
            display: flex;
            align-items: center; 
        }

        .power-switch {
            width: 60px;
            height: 30px;
            border-radius: 15px;
            background-color: #ccc;
            position: relative;
            cursor: pointer;
            outline: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

            .power-switch:hover {
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            }

            .power-switch::before {
                content: '';
                position: absolute;
                top: 50%;
                left: 5px;
                width: 25px;
                height: 25px;
                border-radius: 50%;
                background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0);
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4), inset 0 -2px 6px rgba(0, 0, 0, 0.3);
                transform: translateY(-50%);
                transition: left 0.3s, transform 0.3s;
            }

            .power-switch.active {
                background-color: #4caf50;
                box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            .power-switch.active::before {
                left: calc(100% - 30px);
                transform: translateY(-50%) scale(1.1);
            }

        .mode-label {
            font-size: 16px;
            font-weight: bold;
            margin-right: 10px;
            color: #555;
            background: linear-gradient(45deg, #eeeeee, #cccccc); 
            padding: 3px 10px;
            border-radius: 5px;
            box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            display: inline-block;
            transition: color 0.3s, background 0.3s;
        }

            .mode-label:hover {
                background: linear-gradient(45deg, #cccccc, #bbbbbb);
                color: #333;
            }

        
            body.dark-mode .mode-label {
                background: linear-gradient(45deg, #333333, #555555); 
                color: #ddd; 
            }


            .simple-btn {
                padding: 0px 15px;
                font-size: 16px;
                height: calc(40px * 2 / 3); 
                line-height: calc(40px * 2 / 3); 
                text-align: center;
                border: 2px solid #333;
                border-radius: 0;
                background-color: #f0f0f0;
                color: #333;
                box-shadow: 3px 3px 0px rgba(0, 0, 0, 0.5);
                font-family: 'KaiTi', 'Noto Sans SC', 'Microsoft YaHei', sans-serif; 
                cursor: pointer;
                transition: background-color 0.3s ease, box-shadow 0.3s ease;
            }

                .simple-btn:hover {
                    background-color: #e0e0e0;
                    box-shadow: 5px 5px 0px rgba(0, 0, 0, 0.5);
                }

                .simple-btn:active {
                    background-color: #ccc;
                    box-shadow: 0px 0px 0px rgba(0, 0, 0, 0.5);
                }

        /* Styles from Pure Css Wave Progress bar Animation */
        .wave-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border-radius: 50%;
            overflow: hidden;
            background: radial-gradient(circle at 70% 30%, rgba(150, 180, 255, 0.5), rgba(60, 100, 150, 0.2) 70%, rgba(0, 50, 80, 0.5) 100%);
            border: 5px solid rgba(100, 180, 255, 0.4);
            box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.1),
                        0 0 30px rgba(100, 180, 255, 0.3);
        }

        /* 调整光斑效果 */
        .wave-container::before {
            content: '';
            position: absolute;
            top: 15px;  
            left: 110px;  
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0)); 
            opacity: 0.4;  
            pointer-events: none;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);  
            z-index: 4;
        }

        /* 调整辅助反光区域 */
        .wave-container::after {
            content: '';
            position: absolute;
            top: 50px;
            left: 50px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(150, 180, 255, 0.3), transparent 70%);
            opacity: 0.4; 
            pointer-events: none;
            z-index: 3;
        }


        .wave-change {
            position: absolute;
            width: 200px;
            height: 200px;
            left: 0;
            top: 0;
            animation: change 12s linear forwards;
            z-index: 2;
        }

        .wave-change::before,
        .wave-change::after {
            content: "";
            position: absolute;
            width: 400px;
            height: 400px;
            top: 0;
            left: 50%;
            background-color: rgba(150, 180, 255, 0.2); 
            border-radius: 45% 47% 43% 46%;
            transform: translate(-50%, -70%) rotate(0);
            animation: rotate 7s linear infinite;
            z-index: 1;
        }

        .wave-change::after {
            border-radius: 47% 42% 46% 44%;
            background-color: rgba(150, 180, 255, 0.3);
            animation: rotate 9s linear -4s infinite;
            z-index: 1;
        }


        body.dark-mode .wave-container {
            background: radial-gradient(circle at 70% 30%, rgba(60, 100, 150, 0.4), rgba(30, 60, 100, 0.2) 70%, rgba(10, 30, 50, 0.6) 100%);
            border: 5px solid rgba(60, 100, 150, 0.6);
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.05),
                        0 0 20px rgba(60, 100, 150, 0.5);
        }

        body.dark-mode .wave-container::before {
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0)); 
            opacity: 0.3; 
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
        }

        body.dark-mode .wave-change::before,
        body.dark-mode .wave-change::after {
            background-color: rgba(30, 60, 100, 0.2); 
        }

        body.dark-mode .wave-change::after {
            background-color: rgba(30, 60, 100, 0.3); 
        }


        .wave {
            position: relative;
            width: 200px;
            height: 200px;
            background-color: rgb(118, 218, 255);
            border-radius: 50%;
        }

        @keyframes rotate {
            50% {
                transform: translate(-50%, -73%) rotate(180deg);
            }
            100% {
                transform: translate(-50%, -70%) rotate(360deg);
            }
        }

        @keyframes change {
            from {
                top: 90px;
            }
            to {
                top: -120px;
            }
        }


        .percentage-display {
            text-align: center; 
            font-size: 18px; 
            color: #76daff; 
        }


        .metal-plate {
            font-family: 'SimHei', sans-serif;
            font-size: 1.0em;
            color: #3a3a3a;
            letter-spacing: 1px;
            text-transform: uppercase;

            
            background: linear-gradient(135deg, 
                #d7d7d7 0%, 
                #f2f2f2 40%, 
                #bdbdbd 60%, 
                #e0e0e0 100%);
            border-radius: 20px;
            padding: 5px 20px;
            display: inline-block;
            text-align: center;
            position: relative;
            border: 1px solid #a5a5a5;
            box-shadow: 
                inset 2px 2px 5px rgba(0, 0, 0, 0.3), 
                inset -2px -2px 5px rgba(255, 255, 255, 0.8), 
                5px 5px 15px rgba(0, 0, 0, 0.3);
        }

      
        .corner {
            position: absolute;
            width: 6px; 
            height: 6px;
            background: radial-gradient(circle, #999 25%, #555 75%);
            border-radius: 50%;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
        }

        
        .left {
            top: 50%; 
            left: 10px; 
            transform: translateY(-50%); 
        }

        .right {
            top: 50%; 
            right: 10px; 
            transform: translateY(-50%); 
        }

        #recordContainer {
    position: absolute;
    top: 100px;
    right: 5px;
    width: 400px;
    height: 300px; 
    background-color: #f9f9f9;
    color: black;
    overflow-y: auto;
    padding: 5px;
    text-align: left;
    border: 1px solid lightgray; /* 添加1像素的黑色实线边框 */
    border-radius: 3px; /* 可选：让边框有圆角 */
}

body.dark-mode #recordContainer {
    background-color: #333; /* 暗背景 */
    color: white; /* 文字颜色 */
    border: 1px solid #555; /* 更暗的边框 */
}


#archiveButton {
    position: absolute; 
    top: 420px;
    right: 225px; 
    font-size: 14px;
    cursor: pointer;
}

#paperShredderButton {
    position: absolute; 
    top: 420px;
    right: 10px; 
    font-size: 14px;
    cursor: pointer;
}

#compareBtn {
    position: absolute; 
    top: 610px;
    left: 10px; 
    font-size: 14px;
    cursor: pointer;
}

#clearPasteAreaBtn {
    position: absolute; 
    top: 610px;
    left: 290px; 
    font-size: 14px;
    cursor: pointer;
}



.aiCredit, .aiBank1, .aiBank2, .aiTax, .aiWechat, .aiHouse1, .aiHouse2{
    color: skyblue;
    font-weight: bold;
}

.offlineCredit, .offlineBank1, .offlineBank2, .offlineTax, .offlineWechat, .offlineHouse1, .offlineHouse2{
    color: lightpink;
    font-weight: bold;
}

#recordLastDayContainer {
    position: absolute;
    top: 100px;
    left: 5px;
    width: 400px;
    height: 300px; 
    background-color: #f9f9f9;
    color: black;
    overflow-y: auto;
    padding: 5px;
    text-align: left;
    border: 1px solid lightgray; /* 添加1像素的黑色实线边框 */
    border-radius: 3px; /* 可选：让边框有圆角 */
}

body.dark-mode #recordLastDayContainer {
    background-color: #333;
    color: white;
    border: 1px solid #555;
}

.last-day-record {
  position: absolute;
  top: 70px;
  left: 5px;
  font-size: 14px;
  padding: 3px 8px;
  background-color: #f1f1f1;
  border-radius: 5px;
  color: #333;
  font-family: Arial, sans-serif;
}

.this-day-record {
  position: absolute;
  top: 70px;
  right: 317px;
  font-size: 14px;
  padding: 3px 8px;
  background-color: #f1f1f1;
  border-radius: 5px;
  color: #333;
  font-family: Arial, sans-serif;
}

#difference {
    position: absolute;
    top: 680px;
    left: 5px;
    width: 400px;
    height: 200px;
    overflow-y: auto; /* 添加滚动条以防内容超出 */
    border: 1px solid #ccc; /* 边框样式，可选 */
    background-color: #f9f9f9; /* 背景颜色，可选 */
    padding: 10px; /* 内边距 */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 添加阴影效果 */
    border-radius: 5px; /* 圆角，可选 */
    text-align: left;
    padding: 5px;
}

body.dark-mode #difference {
    background-color: #222; /* 更暗的背景 */
    color: white;
    border: 1px solid #444; /* 更暗的边框 */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* 加强阴影效果 */
}

#data-comparison-result-title {
  position: absolute;
  top: 650px;
  left: 103px;
  font-size: 14px; /* 增加字体大小 */
  padding: 2px 1px; /* 增加内边距 */
  background: linear-gradient(45deg, #1a1a1a, #333333); /* 线性渐变背景 */
  color: #00e0ff; /* 字体颜色 */
  border-radius: 5px;
  box-shadow: 0 4px 15px rgba(0, 224, 255, 0.3); /* 投影效果 */
  border: 1px solid transparent;
  z-index: 9999;
  text-align: center;
  width: 200px;
  display: inline-block; /* 保持块级元素 */
  overflow: hidden; /* 防止内容溢出 */
  transition: color 0.3s, background 0.3s, box-shadow 0.3s; /* 过渡效果 */
}

#data-comparison-result-title::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 200%;
  height: 100%;
  background: linear-gradient(120deg, transparent, rgba(0, 224, 255, 0.2), transparent);
  transform: skewX(-20deg);
  transition: left 0.5s ease;
}

#data-comparison-result-title h3 {
  font-size: 16px;
  margin: 0;
  font-weight: 500;
  letter-spacing: 1px;
  text-transform: uppercase;
}

/* 默认模式样式 */
#excelData {
    position: absolute;
    top: 440px;
    left: 5px;
    height: 150px;
    width: 400px;
    background-color: #fff; /* 背景颜色 */
    color: black; /* 文字颜色 */
    border: 1px solid #ccc; /* 边框颜色 */
    font-family: Arial, sans-serif; /* 字体 */
    font-size: 14px; /* 字号 */
    padding: 5px;
    cursor: text; /* 鼠标悬停时显示文本光标 */
}


/* 暗黑模式样式 */
body.dark-mode #excelData {
    background-color: #333; /* 暗背景 */
    color: white; /* 文字颜色 */
    border: 1px solid #555; /* 暗色边框 */
    padding: 5px;
    font-family: Arial, sans-serif;
    font-size: 14px;
    cursor: text; /* 鼠标悬停时显示文本光标 */
}








    </style>

    <script>
        window.addEventListener('load', function () {
            const currentVersion = '1.6.0';  

            const storedVersion = localStorage.getItem('version');

            if (!storedVersion || storedVersion !== currentVersion) {
                localStorage.setItem('version', currentVersion);
                location.reload(true);  
            }
        });
    </script>

        <link rel="icon" href="images/logo-crystalBall.ico" type="image/x-icon">
        <link rel="shortcut icon" href="images/logo-crystalBall.ico" type="image/x-icon"> 


        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-2GKERV0V0Y"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-2GKERV0V0Y');
        </script>



<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://wsdworkgd10.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='https://cdn.matomo.cloud/wsdworkgd10.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->



  
</head>
<body>
        <div class="theme-switcher"><span class="mode-label">夜间模式</span><button id="theme-toggle" class="power-switch"></button></div>

        <a href="v-1-5-2.html"  target="_blank"  style="position: absolute; top: 10px; right: 200px; font-size: 14px; text-decoration: none; color: #007BFF;">返回之前版本v.1.5.2</a>

        <div id="recordLastDayContainer"></div>

        <div class="last-day-record">上一日成交记录</div>

        <div class="this-day-record">当日成交记录</div>

        <link rel="stylesheet" href="styles.css">

        <textarea id="excelData" placeholder="将Excel数据粘贴到这里
(避免粘贴好之后再手动编辑该区域内的数据，防止破坏分割数据所需的制表符 \t 和换行符 \n)"></textarea>
        
   
        <button id="compareBtn" class="simple-btn">一键比对数据</button>

        <a href="how-to-paste-and-compare.pdf" target="_blank" style="position: absolute; top: 615px; left: 140px; font-size: 14px; text-decoration: none; color: #007BFF;">如何粘贴数据？</a>

        <button id="clearPasteAreaBtn" class="simple-btn">清空粘贴区域</button>

        <div id="data-comparison-result-title"><h3 style="font-weight: bold;">数据比对结果显示区域</h3></div>  

        <div id="difference"></div>

        <div id="recordContainer"></div>

        <button id="archiveButton" class="simple-btn">存档为上一日成交记录</button>

        <button id="paperShredderButton" class="simple-btn">清空全部当日成交记录</button>
        
        <div class="container">
            <div class="title"><span class="metal-plate">提额项目报单计数器
                <span class="corner left"></span>
                <span class="corner right"></span>
            </span> 1.6.0
                <span class="tooltip" data-tooltip="使用说明：&#10;1. 出单之后，勾选对应种类端口后面的复选框；&#10;2. 全部选好之后点击【立即计算】按钮，再输入对应的例子编号，即可自动生成报单文本；&#10;3. 再点击【一键复制】按钮。&#10;注：本计数器具有自动累计功能，页面刷新或浏览器重启都不会丢失数据。&#10; &#10;更新记录 v1.6.0.20241124：&#10;i. 新增了比对线上成交记录和Excel报表对应数据的功能。&#10; &#10;感谢友友们的使用 &#10;祝捷报频传 &#x2764;">?</span>
            </div>
        
        <div class="input-row">
            姓名：<span id="nameDisplay" style="font-family: 'FangSong', serif; font-weight: bold;">鲍得快</span>
            <input type="text" id="nameInput" style="display: none;" value="鲍得快">
            当日目标：<span id="targetDisplay" style="font-family: 'FangSong', serif; font-weight: bold;">500</span>
            <input type="number" id="targetInput" style="display: none;" value="500">
            <span style="font-family: 'FangSong', serif; font-weight: bold;">元</span>
            <button id="editBtn" class="simple-btn">编辑</button>
            <button id="saveBtn" class="simple-btn" style="display: none;">保存</button>
            <button id="cancelBtn" class="simple-btn" style="display: none;">取消</button>            
        </div>
    
        <div class="section">
            <h3>AI端口</h3>
            <div class="input-row">
                <img src="images/icons/credit-icon-32px.png" alt="credit图标" class="icon"> 
                <span style="font-family: 'Fangsong';">授权<b>征信记录</b></span>(<b style="color: #F56C73;">25</b>元/单)：
                <input type="checkbox" id="aiCredit">
                <span id="aiCreditTotal" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/bank-icon-32px.png" alt="bank图标" class="icon"> 
                <span style="font-family: 'Fangsong';">发送<b>银行流水-超网</b></span>(<b style="color: #F56C73;">45</b>元/单)：
                <input type="checkbox" id="aiBank1">
                <span id="aiBank1Total" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/bank-icon-32px.png" alt="bank图标" class="icon"> 
                <span style="font-family: 'Fangsong';">发送<b>银行流水-邮箱</b></span>(<b style="color: #F56C73;">80</b>元/单)：
                <input type="checkbox" id="aiBank2">
                <span id="aiBank2Total" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/tax-icon-32px.png" alt="tax图标" class="icon"> 
                <span style="font-family: 'Fangsong';">授权<b>发票明细-RPA</b></span>(<b style="color: #F56C73;">80</b>元/单)：
                <input type="checkbox" id="aiTax">
                <span id="aiTaxTotal" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/wechat-icon-32px.png" alt="wechat图标" class="icon">
                <span style="font-family: 'Fangsong';">发送<b>微信账单</b></span>(<b style="color: #F56C73;">35</b>元/单)： 
                <input type="checkbox" id="aiWechat">
                <span id="aiWechatTotal" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/house-icon-32px.png" alt="house图标" class="icon"> 
                <span style="font-family: 'Fangsong';">提交<b>房产信息-直连</b></span>(<b style="color: #F56C73;">45</b>元/单)： 
                <input type="checkbox" id="aiHouse1">
                <span id="aiHouse1Total" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/house-icon-32px.png" alt="house图标" class="icon"> 
                <span style="font-family: 'Fangsong';">提交<b>房产信息-复杂</b></span>(<b style="color: #F56C73;">80</b>元/单)： 
                <input type="checkbox" id="aiHouse2">
                <span id="aiHouse2Total" style="display: inline;">已有0单</span>
            </div>
        </div>
        
        <div class="section">
            <h3>离线端口</h3>
            <div class="input-row">
                <img src="images/icons/credit-icon-32px.png" alt="credit图标" class="icon"> 
                <span style="font-family: 'Fangsong';">授权<b>征信记录</b></span>(<b style="color: #F56C73;">30</b>元/单)： 
                <input type="checkbox" id="offlineCredit">
                <span id="offlineCreditTotal" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/bank-icon-32px.png" alt="bank图标" class="icon"> 
                <span style="font-family: 'Fangsong';">发送<b>银行流水-超网</b></span>(<b style="color: #F56C73;">60</b>元/单)： 
                <input type="checkbox" id="offlineBank1">
                <span id="offlineBank1Total" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/bank-icon-32px.png" alt="bank图标" class="icon"> 
                <span style="font-family: 'Fangsong';">发送<b>银行流水-邮箱</b></span>(<b style="color: #F56C73;">100</b>元/单)： 
                <input type="checkbox" id="offlineBank2">
                <span id="offlineBank2Total" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/tax-icon-32px.png" alt="tax图标" class="icon"> 
                <span style="font-family: 'Fangsong';">授权<b>发票明细-RPA</b></span>(<b style="color: #F56C73;">80</b>元/单)： 
                <input type="checkbox" id="offlineTax">
                <span id="offlineTaxTotal" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/wechat-icon-32px.png" alt="wechat图标" class="icon">
                <span style="font-family: 'Fangsong';">发送<b>微信账单</b></span>(<b style="color: #F56C73;">40</b>元/单)： 
                <input type="checkbox" id="offlineWechat">
                <span id="offlineWechatTotal" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/house-icon-32px.png" alt="house图标" class="icon"> 
                <span style="font-family: 'Fangsong';">提交<b>房产信息-直连</b></span>(<b style="color: #F56C73;">60</b>元/单)： 
                <input type="checkbox" id="offlineHouse1">
                <span id="offlineHouse1Total" style="display: inline;">已有0单</span>
            </div>
            <div class="input-row">
                <img src="images/icons/house-icon-32px.png" alt="house图标" class="icon"> 
                <span style="font-family: 'Fangsong';">提交<b>房产信息-复杂</b></span>(<b style="color: #F56C73;">100</b>元/单)： 
                <input type="checkbox" id="offlineHouse2">
                <span id="offlineHouse2Total" style="display: inline;">已有0单</span>
            </div>
        </div>
        
        
    
        <div class="buttons">
            <button class="green">立即计算</button>
            <button class="yellow">撤销本次计算</button>
            <button class="red">强制归零</button>
            <button class="copy-button">一键复制</button>
        </div>        
    
        <div id="result"></div>

        <div class="wave-container">
            <div class="wave"></div>
            <div class="wave-change"></div>
        </div>

        <div class="percentage-display">
            0%
        </div>

        <div id="mailbox-container">
            <img id="mailbox" src="images/mailbox_32px.png" alt="mailbox图标">
            <div id="mailbox-tooltip">点击鼠标左键复制联系方式：<br>ProgrammeurSauvage@hotmail.com</div>
        </div>

        <div id="library-container">
            <a href="https://www.wsd.work.gd/library" target="_blank">
                <img id="library" src="images/library_32px.png" alt="library图标">
            </a>
            <div id="library-tooltip">常用资料<br>（待完善）</div>
        </div>

        <div id="starship-container">
            <img id="starship" src="images/starship_32px.png" alt="starship图标" onclick="redirectToControlPanel()">
            <div id="starship-tooltip">点击鼠标左键切换为“星舰控制台风格”</div>
        </div>
        

        <select id="theme-selector">
            <option value="default">旧版风格</option>
            <option value="led">蓝屏LED风格</option>
            <option value="blackboard">板书风格</option>
            <option value="typewriter">打字机风格</option>
        </select>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => { // DOM 1

            const fields = [
                'aiCredit', 'aiBank1', 'aiBank2', 'aiTax', 'aiWechat', 'aiHouse1', 'aiHouse2',
                'offlineCredit', 'offlineBank1', 'offlineBank2', 'offlineTax', 'offlineWechat', 
                'offlineHouse1', 'offlineHouse2'
            ];


            fields.forEach(field => {
                const total = parseInt(localStorage.getItem(`${field}Total`)) || 0;
                updateDisplay(field, total);
            });


            let tempValues = {};
            fields.forEach(field => tempValues[field] = 0);


            document.querySelectorAll('input[type="checkbox"]').forEach(input => {
                input.addEventListener('change', (event) => {
                    const id = event.target.id;
                    const isChecked = event.target.checked; // 检查是否选中
                    tempValues[id] = isChecked ? 1 : 0; // 用 1 表示选中，0 表示未选中
                    applyHighlight(); // 更新高亮样式
                });
            });



            let lastCalculation = {};

            let lastRecordBundle = null; // 用于存储上次操作的记录

document.querySelector('.green').addEventListener('click', () => {
    // 弹出输入框获取编号
    const inputId = prompt("请输入例子编号 (或 任务编号/客户编号/lead编号/CLEAN)：");
    if (!inputId) {
        alert("编号不能为空！");
        return;
    }

    // 获取现有的记录列表和容器内容，保存当前状态到 lastRecordBundle
    const recordContainer = document.getElementById('recordContainer'); // 假设有一个用于显示记录的容器
    let displayedRecords = JSON.parse(localStorage.getItem('displayedRecords')) || [];
    let existingRecords = JSON.parse(localStorage.getItem('records')) || []; // 读取已存在的数据

    // 保存当前状态到 lastRecordBundle
    lastRecordBundle = {
        caseId: inputId,
        records: [...existingRecords], // 保存撤销前的所有记录
        displayedRecords: [...displayedRecords], // 保存撤销前的 displayedRecords
        recordContainerHTML: recordContainer.innerHTML // 保存当前 recordContainer 的 HTML 内容
    };

    // 调用 calculate 函数
    calculate();

    // ------------------------------------------------------------------------ 这是分割线 ------------------------------------------------------------------------

    // 为每个字段定义对应的标签
    const fieldLabels = {
        aiCredit: '征信',
        aiBank1: '银流-超网',
        aiBank2: '银流-邮箱',
        aiTax: 'RPA',
        aiWechat: '微信账单',
        aiHouse1: '房简',
        aiHouse2: '房复',
        offlineCredit: '征信',
        offlineBank1: '银流-超网',
        offlineBank2: '银流-邮箱',
        offlineTax: 'RPA',
        offlineWechat: '微信账单',
        offlineHouse1: '房简',
        offlineHouse2: '房复'
    };

    // 获取当次计算涉及的标签
    const involvedTags = fields.filter(field => document.getElementById(field)?.checked);

    // 新增记录内容
    const newRecord = document.createElement('div');
    newRecord.classList.add('record');

    // 确定序号
    const recordNumber = String(recordContainer.children.length + 1).padStart(2, '0'); // 根据现有记录数量计算序号

    // 生成记录内容：用标签代替字段名
    const involvedDetails = involvedTags.map(tag => `<span class="${tag}">${fieldLabels[tag] || tag}</span>`).join(', ');

    // 设置记录内容，包括序号和 inputId 的样式
    newRecord.innerHTML = `<span style="font-size: 12px;">${recordNumber} |</span> <span style="font-size: 12px;">${inputId}</span> <span style="font-size: 12px;">|</span> <span style="font-size: 12px;">${involvedDetails}</span>`;

    // 将记录添加到容器中
    recordContainer.appendChild(newRecord);

    // 更新 displayedRecords
    displayedRecords.push({
        inputId,
        involvedDetails
    });

    // 保存更新后的 displayedRecords 到 localStorage
    localStorage.setItem('displayedRecords', JSON.stringify(displayedRecords));

    // 新功能：将每个标签创建为单独的对象并存储到 localStorage
    const newRecords = involvedTags.map(tag => ({
        caseId: inputId,
        involvedTag: tag
    }));

    // 合并新旧数据
    const updatedRecords = [...existingRecords, ...newRecords];

    // 更新 localStorage
    localStorage.setItem('records', JSON.stringify(updatedRecords));

    // ------------------------------------------------------------------------ 这是分割线 ------------------------------------------------------------------------

    // 保存当前状态到 lastRecordBundle
    // 这一部分不再需要，已提前保存
    // lastRecordBundle = {
    //     caseId: inputId,
    //     records: [...existingRecords], // 保存撤销前的所有记录
    //     displayedRecords: [...displayedRecords], // 保存撤销前的 displayedRecords
    //     recordContainerHTML: recordContainer.innerHTML // 保存当前 recordContainer 的 HTML 内容
    // };

    // 保存当前状态
    lastCalculation = fields.reduce((acc, field) => {
        acc[field] = localStorage.getItem(`${field}Total`) || 0;
        return acc;
    }, {});

    // 更新每个字段的总数
    fields.forEach(field => {
        const previousTotal = parseInt(localStorage.getItem(`${field}Total`)) || 0;

        // 使用复选框的选中状态来更新总数
        const newTotal = previousTotal + (document.getElementById(field).checked ? 1 : 0);

        // 保存更新后的总数
        localStorage.setItem(`${field}Total`, newTotal);

        // 更新显示
        updateDisplay(field, newTotal);
    });

    // 清空临时存储的字段
    fields.forEach(field => tempValues[field] = 0);

    // 清空所有复选框
    document.querySelectorAll('input[type="checkbox"]').forEach(input => input.checked = false);

    // 重新应用高亮
    applyHighlight();

    calculateWaveAnimation();
});


            document.querySelector('.yellow').addEventListener('click', () => {
                if (Object.keys(lastCalculation).length > 0) {
                    fields.forEach(field => {
                        localStorage.setItem(`${field}Total`, lastCalculation[field]);
                        updateDisplay(field, lastCalculation[field]);
                    });
                    lastCalculation = {};  
                }

                fields.forEach(field => tempValues[field] = 0);
                document.querySelectorAll('input[type="checkbox"]').forEach(input => input.checked = false); // 设置为未选中
                applyHighlight();

                if (!lastRecordBundle) {
        alert("没有可撤销的记录！");
        return;
    }

    const { caseId, records, displayedRecords, recordContainerHTML } = lastRecordBundle;

    // 从 localStorage 中恢复到撤销前的状态
    localStorage.setItem('records', JSON.stringify(records)); // 恢复 records
    localStorage.setItem('displayedRecords', JSON.stringify(displayedRecords)); // 恢复 displayedRecords

    // 恢复对应的 recordContainer 内容
    document.getElementById('recordContainer').innerHTML = recordContainerHTML;

    // 清空 lastRecordBundle 防止多次撤销
    lastRecordBundle = null;

    // 提示用户撤销成功
    alert(`编号为 ${caseId} 的记录已被撤销！`);

            });


            document.querySelector('.red').addEventListener('click', () => {
                fields.forEach(field => tempValues[field] = 0);

                // 重置所有复选框的选中状态
                document.querySelectorAll('input[type="checkbox"]').forEach(input => input.checked = false);

                applyHighlight();
            });

        // ------------------------------------------------------------------------ 这是分割线 ------------------------------------------------------------------------

// 获取相关的 DOM 元素
const archiveButton = document.getElementById('archiveButton');
const paperShredderButton = document.getElementById('paperShredderButton'); 
const recordContainer = document.getElementById('recordContainer');
const recordLastDayContainer = document.getElementById('recordLastDayContainer');

// 按钮点击事件
archiveButton.addEventListener('click', () => {
    // 弹出确认对话框
    const userConfirmed = confirm('确定真的存档为上一日成交记录？');

    // 如果用户点击“取消”，终止操作
    if (!userConfirmed) {
        return;
    }

    // 1. 处理 localStorage 中的 records 数据
    const records = JSON.parse(localStorage.getItem('records')) || []; // 获取当前 records 数据
    localStorage.setItem('recordsLastDay', JSON.stringify(records)); // 存为 recordsLastDay
    localStorage.setItem('records', JSON.stringify([])); // 清空 records

    // 2. 处理 localStorage 中的 displayedRecords 数据
    const displayedRecords = JSON.parse(localStorage.getItem('displayedRecords')) || []; // 获取当前 displayedRecords 数据
    localStorage.setItem('displayedRecordsLastDay', JSON.stringify(displayedRecords)); // 存为 displayedRecordsLastDay
    localStorage.setItem('displayedRecords', JSON.stringify([])); // 清空 displayedRecords

    // 3. 转移页面中的记录
    // 先清空 recordLastDayContainer 的内容
    while (recordLastDayContainer.firstChild) {
        recordLastDayContainer.removeChild(recordLastDayContainer.firstChild);
    }

    // 将 recordContainer 的子节点转移到 recordLastDayContainer
    while (recordContainer.firstChild) {
        recordLastDayContainer.appendChild(recordContainer.firstChild);
    }

    // 确保 recordContainer 为空
    recordContainer.innerHTML = ''; 
});


// 按钮点击事件 - 销毁按钮
paperShredderButton.addEventListener('click', () => {
    // 弹窗确认
    if (confirm('确定真的清空当日全部成交记录？')) {
        // 清除 localStorage 中的 records 和 displayedRecords
        localStorage.removeItem('records');
        localStorage.removeItem('displayedRecords');

        // 清空 recordContainer 中的所有记录（不影响 recordLastDayContainer）
        recordContainer.innerHTML = ''; // 清空内容

        // 这里保留 recordLastDayContainer 中的内容，无需操作
    }
});

    // ------------------------------------------------------------------------ 这是分割线 ------------------------------------------------------------------------

        // 解析 Excel 数据
        function parseExcelData(rawData) {
        const rows = rawData.trim().split("\n");

        // 定义后缀映射规则
        const suffixMapping = {
            "信提": "Credit",
            "银流-超网": "Bank1",
            "银流-邮箱": "Bank2",
            "微信账单": "Wechat",
            "房简": "House1",
            "房复": "House2"
        };

        return rows.map(row => {
            const values = row.split("\t");
            const caseId = values[0] || ""; // 第一列默认字段名为 caseId
            const originalValue = values[1] || ""; // 第二列的原始值

            // 根据第一列字符串长度判断前缀
            let prefix = "";
            if (caseId.length === 35) {
            prefix = "ai";
            } else if (caseId.length === 22) {
            prefix = "offline";
            }

            // 根据映射规则确定后缀
            const suffix = suffixMapping[originalValue] || originalValue; // 如果没有匹配到，保留原始值

            return {
            caseId: caseId,
            involvedTag: prefix && suffix ? `${prefix}${suffix}` : "" // 拼接前缀和后缀
            };
        });
        }

    // ------------------------------------------------------------------------ 这是分割线 ------------------------------------------------------------------------

        // 比对逻辑
        document.getElementById("compareBtn").addEventListener("click", () => {
        const excelRawData = document.getElementById("excelData").value.trim();
        const excelData = parseExcelData(excelRawData); // 解析 Excel 数据
        const localData = JSON.parse(localStorage.getItem("recordsLastDay") || "[]"); // 获取 localStorage 数据

        // 转换为 Set 格式进行高效比对
        const localDataSet = new Set(
            localData.map(item => `${item.caseId}_${item.involvedTag}`)
        );

        // 找出 Excel 中有而 localStorage 中没有的数据
        const notInLocal = excelData.filter(
            excelItem => !localDataSet.has(`${excelItem.caseId}_${excelItem.involvedTag}`)
        );

        // 转换为 Set 格式进行高效比对
        const excelDataSet = new Set(
            excelData.map(item => `${item.caseId}_${item.involvedTag}`)
        );

        // 找出 localStorage 中有而 Excel 中没有的数据
        const notInExcel = localData.filter(
            localItem => !excelDataSet.has(`${localItem.caseId}_${localItem.involvedTag}`)
        );

        // ------------------------------------------------------------------------ 这是分割线 ------------------------------------------------------------------------

        // 显示比对结果
        const differenceDiv = document.getElementById("difference");

        // 辅助函数：将比对结果按 caseId 分组
        function groupByCaseId(data) {
        return data.reduce((result, item) => {
            if (!result[item.caseId]) {
            result[item.caseId] = []; // 如果 caseId 尚未存在，初始化一个数组
            }
            result[item.caseId].push(item.involvedTag); // 将 involvedTag 添加到对应 caseId 的数组中
            return result;
        }, {});
        }

        // 按 caseId 分组后的数据
        const groupedNotInLocal = groupByCaseId(notInLocal);
        const groupedNotInExcel = groupByCaseId(notInExcel);


// 定义 tag 对应关系
const tagMappings = {
    aiCredit: "征信",
    aiBank1: "银流-超网",
    aiBank2: "银流-邮箱",
    aiTax: "RPA",
    aiWechat: "微信账单",
    aiHouse1: "房简",
    aiHouse2: "房复",
    offlineCredit: "征信",
    offlineBank1: "银流-超网",
    offlineBank2: "银流-邮箱",
    offlineTax: "RPA",
    offlineWechat: "微信账单",
    offlineHouse1: "房简",
    offlineHouse2: "房复"
};

// 格式化输出为 HTML
function formatGroupedData(groupedData) {
    return Object.entries(groupedData)
        .map(([caseId, tags]) => {
            // 将 tags 转换为映射的中文名称
            const tagsList = tags.map(tag => tagMappings[tag] || tag).join(", "); // 使用映射关系转换，未匹配的直接显示原值
            return `
                <p style="font-size: 12px;">
                    <span style="font-weight: bold;">${caseId}</span> | ${tagsList}
                </p>`;
        })
        .join("");
}


        // 显示比对结果
        differenceDiv.innerHTML = `
        <p>&#x270C;<strong style="font-family: 'FangSong', serif;"> Excel中有而线上成交记录中没有的数据：</strong></p>
        ${formatGroupedData(groupedNotInLocal)}
        <p>&#x270D;<strong style="font-family: 'FangSong', serif;"> 线上成交记录中有而Excel中没有的数据：</strong></p>
        ${formatGroupedData(groupedNotInExcel)}
        `;

        });

        document.getElementById("clearPasteAreaBtn").addEventListener("click", function() {
    document.getElementById("excelData").value = ""; // 清空textarea的内容
});


    });

        document.addEventListener('DOMContentLoaded', () => { // DOM 2
            const savedName = localStorage.getItem('savedName');
            const savedTarget = localStorage.getItem('savedTarget');

            if (savedName) {
                document.getElementById('nameDisplay').textContent = savedName;
                document.getElementById('nameInput').value = savedName;
            }

            if (savedTarget) {
                document.getElementById('targetDisplay').textContent = savedTarget;
                document.getElementById('targetInput').value = savedTarget;
            }

            applyHighlight();
        });

        document.addEventListener('DOMContentLoaded', () => { // DOM 3

            const currentTheme = localStorage.getItem('theme');

            if (currentTheme === 'dark') {

                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').classList.add('active');
            } else {

                document.getElementById('theme-toggle').classList.remove('active');
            }


            updateAllDisplays();
        });

        document.addEventListener('DOMContentLoaded', () => {  // DOM 4

            const savedResult = localStorage.getItem('calculationResult');
            if (savedResult) {
                document.getElementById('result').textContent = JSON.parse(savedResult).resultText;
            }


            applyHighlight();


            document.getElementById('editBtn').addEventListener('click', () => {
                document.getElementById('targetInput').value = document.getElementById('targetDisplay').textContent; // 保留目标值
                document.getElementById('nameDisplay').style.display = 'none';
                document.getElementById('targetDisplay').style.display = 'none';
                document.getElementById('nameInput').style.display = 'inline';
                document.getElementById('targetInput').style.display = 'inline';
                document.getElementById('saveBtn').style.display = 'inline';
                document.getElementById('cancelBtn').style.display = 'inline';
                document.getElementById('editBtn').style.display = 'none';
            });


            document.getElementById('saveBtn').addEventListener('click', () => {
                const newName = document.getElementById('nameInput').value;
                const newTarget = parseInt(document.getElementById('targetInput').value);


                localStorage.setItem('savedName', newName);
                localStorage.setItem('savedTarget', newTarget);

                document.getElementById('nameDisplay').textContent = newName;
                document.getElementById('targetDisplay').textContent = newTarget;

                document.getElementById('nameDisplay').style.display = 'inline';
                document.getElementById('targetDisplay').style.display = 'inline';
                document.getElementById('nameInput').style.display = 'none';
                document.getElementById('targetInput').style.display = 'none';
                document.getElementById('saveBtn').style.display = 'none';
                document.getElementById('cancelBtn').style.display = 'none';
                document.getElementById('editBtn').style.display = 'inline';
            });


            document.getElementById('cancelBtn').addEventListener('click', () => {
                document.getElementById('nameInput').value = document.getElementById('nameDisplay').textContent;
                document.getElementById('targetInput').value = document.getElementById('targetDisplay').textContent;

                document.getElementById('nameDisplay').style.display = 'inline';
                document.getElementById('targetDisplay').style.display = 'inline';
                document.getElementById('nameInput').style.display = 'none';
                document.getElementById('targetInput').style.display = 'none';
                document.getElementById('saveBtn').style.display = 'none';
                document.getElementById('cancelBtn').style.display = 'none';
                document.getElementById('editBtn').style.display = 'inline';
            });
        });



        let totalOrders = parseInt(localStorage.getItem('totalOrders')) || 0;
        let totalAmount = parseInt(localStorage.getItem('totalAmount')) || 0;
        let aiTotalOrders = parseInt(localStorage.getItem('aiTotalOrders')) || 0;
        let lastCalculation = JSON.parse(localStorage.getItem('lastCalculation')) || {};
        let prevState = {};  
    
        function calculate() {
                const name = document.getElementById('nameDisplay').textContent;
                const target = parseInt(document.getElementById('targetDisplay').textContent);

                // 获取复选框的选中状态（选中为1，未选中为0）
                const aiCredit = document.getElementById('aiCredit').checked ? 1 : 0;
                const aiBank1 = document.getElementById('aiBank1').checked ? 1 : 0;
                const aiBank2 = document.getElementById('aiBank2').checked ? 1 : 0;
                const aiTax = document.getElementById('aiTax').checked ? 1 : 0;
                const aiWechat = document.getElementById('aiWechat').checked ? 1 : 0;
                const aiHouse1 = document.getElementById('aiHouse1').checked ? 1 : 0;
                const aiHouse2 = document.getElementById('aiHouse2').checked ? 1 : 0;

                const offlineCredit = document.getElementById('offlineCredit').checked ? 1 : 0;
                const offlineBank1 = document.getElementById('offlineBank1').checked ? 1 : 0;
                const offlineBank2 = document.getElementById('offlineBank2').checked ? 1 : 0;
                const offlineTax = document.getElementById('offlineTax').checked ? 1 : 0;
                const offlineWechat = document.getElementById('offlineWechat').checked ? 1 : 0;
                const offlineHouse1 = document.getElementById('offlineHouse1').checked ? 1 : 0;
                const offlineHouse2 = document.getElementById('offlineHouse2').checked ? 1 : 0;
                
                // 计算当次完成订单总金额
                const totalCurrent = (aiCredit * 25) + (aiBank1 * 45) + (aiBank2 * 80) + (aiTax * 80) + (aiWechat * 35) + (aiHouse1 * 45) + (aiHouse2 * 80)
                                    + (offlineCredit * 30) + (offlineBank1 * 60) + (offlineBank2 * 100) + (offlineTax * 80) + (offlineWechat * 40) + (offlineHouse1 * 60) + (offlineHouse2 * 100);
                
                // 更新总单数
                const totalCurrentOrders = aiCredit + aiBank1 + aiBank2 + aiTax + aiWechat + aiHouse1 + aiHouse2 
                                            + offlineCredit + offlineBank1 + offlineBank2 + offlineTax + offlineWechat + offlineHouse1 + offlineHouse2;
                
                // 保存当前状态到 prevState
                prevState = {
                    totalOrders, 
                    totalAmount, 
                    aiTotalOrders, 
                    resultText: document.getElementById('result').textContent 
                };
                
                totalOrders += totalCurrentOrders;
                totalAmount += totalCurrent;
                aiTotalOrders += (aiCredit + aiBank1 + aiBank2 + aiTax + aiWechat + aiHouse1 + aiHouse2);
                
                const diff = target - totalAmount;
                const diffText = diff >= 0 ? `差额 ${diff} 元` : `超额 ${Math.abs(diff)} 元`;
                
                const resultText = `日目标 ${target} 元，${name}本次新增完成 ${totalCurrent} 元，总单 ${totalOrders} 单（AI ${aiTotalOrders} 单），当日累计完成 ${totalAmount} 元，${diffText}，其他伙伴加油[加油]`;
                document.getElementById('result').textContent = resultText;

                // 保存计算结果
                const result = {
                    dayGoal: target,
                    totalCompletedOrders: totalCurrent,
                    aiCompletedOrders: aiTotalOrders,
                    difference: diff,
                    resultText: resultText
                };
                localStorage.setItem('calculationResult', JSON.stringify(result));

                // 保存最近一次的计算结果以便撤销
                lastCalculation = {
                    aiCredit,
                    aiBank1,
                    aiBank2,
                    aiTax,
                    aiWechat,
                    aiHouse1,
                    aiHouse2,
                    offlineCredit,
                    offlineBank1,
                    offlineBank2,
                    offlineTax,
                    offlineWechat,
                    offlineHouse1,
                    offlineHouse2,
                    resultText
                };
                localStorage.setItem('lastCalculation', JSON.stringify(lastCalculation));
                
                // 保存当前总单数和金额
                localStorage.setItem('totalOrders', totalOrders);
                localStorage.setItem('totalAmount', totalAmount);
                localStorage.setItem('aiTotalOrders', aiTotalOrders);
            
            }

    
        function undo() {
            if (Object.keys(prevState).length > 0) { // 判断是否有保存的状态
                const { aiCredit, aiBank1, aiBank2, aiTax, aiWechat, aiHouse1, aiHouse2, 
                        offlineCredit, offlineBank1, offlineBank2, offlineTax, offlineWechat, 
                        offlineHouse1, offlineHouse2, resultText, totalOrders: prevTotalOrders, 
                        totalAmount: prevTotalAmount, aiTotalOrders: prevAiTotalOrders } = prevState; // 使用 prevState 代替 lastCalculation
    
                document.getElementById('aiCredit').value = aiCredit || 0;
                document.getElementById('aiBank1').value = aiBank1 || 0;
                document.getElementById('aiBank2').value = aiBank2 || 0;
                document.getElementById('aiTax').value = aiTax || 0;
                document.getElementById('aiWechat').value = aiWechat || 0;
                document.getElementById('aiHouse1').value = aiHouse1 || 0;
                document.getElementById('aiHouse2').value = aiHouse2 || 0;
                document.getElementById('offlineCredit').value = offlineCredit || 0;
                document.getElementById('offlineBank1').value = offlineBank1 || 0;
                document.getElementById('offlineBank2').value = offlineBank2 || 0;
                document.getElementById('offlineTax').value = offlineTax || 0;
                document.getElementById('offlineWechat').value = offlineWechat || 0;
                document.getElementById('offlineHouse1').value = offlineHouse1 || 0;
                document.getElementById('offlineHouse2').value = offlineHouse2 || 0;
            
                // 恢复保存的订单总数和AI订单总数
                totalOrders = prevTotalOrders;
                totalAmount = prevTotalAmount;
                aiTotalOrders = prevAiTotalOrders;
            
                // 更新本地存储
                localStorage.setItem('totalOrders', totalOrders);
                localStorage.setItem('totalAmount', totalAmount);
                localStorage.setItem('aiTotalOrders', aiTotalOrders);
            
                // 显示最近一次的计算结果
                document.getElementById('result').textContent = resultText;
                
                // save the latest result of function undo()
                const result = {
                dayGoal: parseInt(document.getElementById('targetDisplay').textContent),
                totalCompletedOrders: totalAmount,
                aiCompletedOrders: aiTotalOrders,
                difference: parseInt(document.getElementById('targetDisplay').textContent) - totalAmount,
                resultText: resultText
                };
                localStorage.setItem('calculationResult', JSON.stringify(result));

            
                // 清空 prevState，防止多次撤销
                prevState = {};
            }
            
            // 重新应用高亮效果
            applyHighlight();
        }
    
        // 添加事件监听

        document.querySelector('.yellow').addEventListener('click', undo);
        document.querySelector('.red').addEventListener('click', confirmReset);
        document.querySelector('.copy-button').addEventListener('click', copyResult);

        function confirmReset() {
            if (confirm('确定真的强制归零？')) {

                // 清除本地存储中的数据
                localStorage.removeItem('totalOrders');
                localStorage.removeItem('totalAmount');
                localStorage.removeItem('aiTotalOrders');
                localStorage.removeItem('lastCalculation');
                localStorage.removeItem('calculationResult'); // 清除计算结果

                // 清除结果栏
                document.getElementById('result').textContent = '';

                // 重置内存中的数据
                totalOrders = 0;
                totalAmount = 0;
                aiTotalOrders = 0;
                lastCalculation = {};

                // 更新本地存储中的数据
                localStorage.setItem('totalOrders', totalOrders);
                localStorage.setItem('totalAmount', totalAmount);
                localStorage.setItem('aiTotalOrders', aiTotalOrders);
                localStorage.setItem('lastCalculation', JSON.stringify(lastCalculation));

                // 重新应用高亮
                applyHighlight();

                resetOrderDisplay();

                // 弹窗提示
        alert('请手动选择【存档为上一日成交记录】或【清空全部当日成交记录】');
            }
        }

        function resetOrderDisplay() {
            const fields = ['aiCredit', 'aiBank1', 'aiBank2', 'aiTax', 'aiWechat', 'aiHouse1', 'aiHouse2',
                            'offlineCredit', 'offlineBank1', 'offlineBank2', 'offlineTax', 'offlineWechat', 
                            'offlineHouse1', 'offlineHouse2']; 

            fields.forEach(field => {
                localStorage.setItem(`${field}Total`, 0);
                document.getElementById(`${field}Total`).innerHTML = `已有<span>${0}</span>单`; // 使用正常样式
            });
        }


    
        function copyResult() {
            const resultText = document.getElementById('result').textContent;
            navigator.clipboard.writeText(resultText)
                .then(() => alert('结果已复制到剪贴板'))
                .catch(err => alert('复制失败'));
        }
    
        function applyHighlight() {
            const isDarkMode = document.body.classList.contains('dark-mode');

            document.querySelectorAll('input[type="checkbox"]').forEach(input => {
            const label = input.parentElement.querySelector('b');

            const highlightStyles = {
                lightMode: {
                    backgroundColor: 'yellow',
                    color: 'black'
                },
                darkMode: {
                    backgroundColor: 'indigo',
                    color: 'yellow'
                }
        };

            const currentHighlightStyles = isDarkMode ? highlightStyles.darkMode : highlightStyles.lightMode;

            if (input.id !== 'targetInput') {
                if (input.checked) {
                    input.classList.add('highlight');
                    input.style.backgroundColor = currentHighlightStyles.backgroundColor;
                    input.style.color = currentHighlightStyles.color;
                    if (label) {
                        label.classList.add('highlight');
                        label.style.backgroundColor = currentHighlightStyles.backgroundColor;
                        label.style.color = currentHighlightStyles.color;
                    }
                } else {
                    input.classList.remove('highlight');
                    input.style.backgroundColor = ''; 
                    input.style.color = '';
                    if (label) {
                        label.classList.remove('highlight');
                        label.style.backgroundColor = ''; 
                        label.style.color = '';
                    }
                }
            } else {
                input.classList.remove('highlight');
                input.style.backgroundColor = ''; 
                input.style.color = '';
                if (label) {
                    label.classList.remove('highlight');
                    label.style.backgroundColor = ''; 
                    label.style.color = '';
                }
            }
        });
        }   


        function updateDisplay(field, total) {
            const displayElement = document.getElementById(`${field}Total`);
            
            const isDarkMode = document.body.classList.contains('dark-mode');
            
            const color = isDarkMode ? 'gold' : 'orange';
            
            const totalText = total > 0 ? `<span style="font-weight: bold; color: ${color};">${total}</span>` : '0';
            displayElement.innerHTML = `已有${totalText}单`;
        }


        function updateAllDisplays() {
            const fields = [
                'aiCredit', 'aiBank1', 'aiBank2', 'aiTax', 'aiWechat', 'aiHouse1', 'aiHouse2',
                'offlineCredit', 'offlineBank1', 'offlineBank2', 'offlineTax', 'offlineWechat', 
                'offlineHouse1', 'offlineHouse2'
            ];
            
            fields.forEach(field => {
                const total = parseInt(localStorage.getItem(`${field}Total`)) || 0;
                updateDisplay(field, total);
            });
        }


        document.getElementById('theme-toggle').addEventListener('click', () => {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');

            document.getElementById('theme-toggle').classList.toggle('active');

            updateAllDisplays();
        });





        window.addEventListener('DOMContentLoaded', () => {

            const savedTheme = localStorage.getItem('theme');
            const resultElement = document.getElementById('result');
            const themeSelector = document.getElementById('theme-selector');
            
            if (savedTheme) {

                document.body.classList.toggle('dark-mode', savedTheme === 'dark');
                
                const selectedTheme = localStorage.getItem('selectedTheme') || 'led';
                resultElement.className = selectedTheme;
                themeSelector.value = selectedTheme;
            } else {

                resultElement.classList.add('led');
                themeSelector.value = 'led';
            }

// 页面加载时从 localStorage 加载记录并显示
const savedRecords = JSON.parse(localStorage.getItem('displayedRecords')) || [];
const savedRecordsLastDay = JSON.parse(localStorage.getItem('displayedRecordsLastDay')) || [];

// 显示当天记录
savedRecords.forEach((record, index) => {
    const recordElement = document.createElement('div');
    recordElement.classList.add('record');
    const recordNumber = String(index + 1).padStart(2, '0'); // 序号格式化为两位数字
    recordElement.innerHTML = `<span style="font-size: 12px;">${recordNumber} |</span> <span style="font-size: 12px;">${record.inputId}</span> <span style="font-size: 12px;">|</span> <span style="font-size: 12px;">${record.involvedDetails}</span>`;
    recordContainer.appendChild(recordElement);
});

// 显示上一天记录
savedRecordsLastDay.forEach((record, index) => {
    const recordElement = document.createElement('div');
    recordElement.classList.add('record');
    const recordNumber = String(index + 1).padStart(2, '0'); // 序号格式化为两位数字
    recordElement.innerHTML = `<span style="font-size: 12px;">${recordNumber} |</span> <span style="font-size: 12px;">${record.inputId}</span> <span style="font-size: 12px;">|</span> <span style="font-size: 12px;">${record.involvedDetails}</span>`;
    recordLastDayContainer.appendChild(recordElement);
});



        });

        document.getElementById('theme-selector').addEventListener('change', function() {
            const selectedTheme = this.value;
            const resultElement = document.getElementById('result');

            resultElement.className = '';

            resultElement.classList.add(selectedTheme);

            localStorage.setItem('selectedTheme', selectedTheme);
        });


        const nightIcons = {
            credit: "images/icons/night/credit-icon-32px.png",
            bank: "images/icons/night/bank-icon-32px.png",
            tax: "images/icons/night/tax-icon-32px.png",
            wechat: "images/icons/night/wechat-icon-32px.png",
            house: "images/icons/night/house-icon-32px.png",
        };


        function toggleNightMode() {
            const isNightMode = document.body.classList.toggle('night-mode'); 

            const icons = document.querySelectorAll('.icon'); 

            icons.forEach(icon => {
                const iconType = icon.alt.split('图标')[0]; 
                if (isNightMode && nightIcons[iconType]) {
                    icon.src = nightIcons[iconType]; 
                } else {
                    icon.src = icon.src.replace('night/', ''); 
                }
            });
        }

                

        document.getElementById('theme-toggle').addEventListener('click', toggleNightMode);

        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').classList.add('active');
                toggleNightMode();  
            }
        });


        let previousLiquidHeightRatio = 0; 
            const radius = 100; 

        function calculateWaveAnimation() {

            const totalAmount = parseFloat(localStorage.getItem('totalAmount')) || 0;
            const target = parseFloat(document.getElementById('targetDisplay').textContent) || 1;

            if (target === 0) {
                alert("目标不能为0");
                return;
            }

            const percentageOfCompletion = totalAmount / target;

            const percentageDisplay = document.querySelector('.percentage-display');

            percentageDisplay.textContent = `${(percentageOfCompletion * 100).toFixed(0)}%`;

                let newLiquidHeightRatio = getLiquidHeightRatio(percentageOfCompletion);

                const startTop = 90 - 210 * previousLiquidHeightRatio; 
                const endTop = 90 - 210 * newLiquidHeightRatio; 

            const heightDifference = Math.abs(newLiquidHeightRatio - previousLiquidHeightRatio);
            const animationDuration = Math.max(0.5, 12 * heightDifference); 

            const waveChange = document.querySelector('.wave-change');
            waveChange.style.animation = 'none';

            const styleSheet = document.styleSheets[0];
            const keyframesRule = 
            `@keyframes change {
                from { top: ${startTop}px; }
                to { top: ${endTop}px; }
            }`;

            for (let i = 0; i < styleSheet.cssRules.length; i++) {
                if (styleSheet.cssRules[i].name === 'change') {
                    styleSheet.deleteRule(i);
                    break;
                }
            }

            styleSheet.insertRule(keyframesRule, styleSheet.cssRules.length);

            // 确保动画已重置，再应用新的动画
            requestAnimationFrame(() => {
                waveChange.style.animation = `change ${animationDuration}s linear forwards`;
            });

                previousLiquidHeightRatio = newLiquidHeightRatio;
        }


            
        function getLiquidHeightRatio(percentageOfCompletion) {
        const r = 1; 
        const totalVolume = (4 / 3) * Math.PI * Math.pow(r, 3); 
        const targetVolume = totalVolume * percentageOfCompletion; 

            if (percentageOfCompletion >= 1) {
            return 1; 
        }

        let liquidHeight = 0; 
        const increment = 0.001; 

        while (true) {
            const volume = (Math.PI * Math.pow(liquidHeight, 2) * (3 * r - liquidHeight)) / 3;

            if (volume >= targetVolume) {
                break; 
            }
            liquidHeight += increment; 
        }

        return liquidHeight / (r * 2); 
        }

        document.addEventListener('DOMContentLoaded', calculateWaveAnimation);

        document.querySelector('.yellow').addEventListener('click', calculateWaveAnimation);
        document.querySelector('.red').addEventListener('click', calculateWaveAnimation);  









        document.addEventListener('DOMContentLoaded', () => {
            let isEditing = false;  

            document.getElementById('editBtn').addEventListener('click', () => {
                isEditing = true;
            });

            document.getElementById('saveBtn').addEventListener('click', () => {
                isEditing = false;
            });
            document.getElementById('cancelBtn').addEventListener('click', () => {
                isEditing = false;
            });

            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                if (button.id !== 'editBtn' && button.id !== 'saveBtn' && button.id !== 'cancelBtn') {
                    button.addEventListener('click', (event) => {
                        if (isEditing) {
                            alert('请先完成“姓名”或“当日目标”的编辑操作！');
                            event.preventDefault();  
                        }
                    });
                }
            });
        });

    // 为 mailbox 元素添加左键点击EventListener
    document.getElementById('mailbox').addEventListener('click', function(event) {
        navigator.clipboard.writeText('ProgrammeurSauvage@hotmail.com').then(function() {
            alert('已将邮件地址 ProgrammeurSauvage@hotmail.com 复制到剪贴板');
        }).catch(function(err) {
            console.error('复制到剪贴板失败：', err);
        });
    });

    function redirectToControlPanel() {
        window.location.href = "https://www.wsd.work.gd/starship";
    }

    </script>
<footer>
  <a href="http://dnsexit.com"><img src="http://dnsexit.com/images/dns.gif" border=0></a>
</footer>
</body>
</html>
